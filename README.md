# Техническое описание интеграции с веб магазинами.

Данное руководство содержит всю необходимую разработчикам информацию, для успешной реализации интеграции с платежной системой (ПС) Allpay. Интеграция ПС Allpay безопасное и простое взаимодействие.

### ЦЕЛЬ

Сервисы Allpay предназначены для того, чтобы дать возможность онлайн магазинам принимать платежи через систему Allpay. Далее описываются общие принципы взаимодействия между магазином и платежной системой (ПС) Allpay.

### СЦЕНАРИЙ ПЛАТЕЖА

1. Покупатель формирует заказ на сайте продавца
2. Покупатель выбирает систему Allpay в качестве способа платежа
3. Покупатель попадает на портал Allpay для авторизации платежа
4. Покупатель подтверждает платеж
5. Сумма электронных денег за вычетом предусмотренных комиссий переводятся с электронного кошелька Покупателя на электронный кошелек Мерчанта 
6. Allpay сообщает магазину о результате платежа посредством вызова заранее определённого веб-сервиса (URL на сайте продавца)

### ПРИНЦИПЫ ВЗАИМОДЕЙСТВИЯ МЕЖДУ МАГАЗИНОМ И ПС ALLPAY

Обмен информацией происходит через браузер пользователя и веб-сервисы. Для обмена данными используется формат XML, для всех видов передаваемых сообщений определена соответствующая схема XSD. Для безопасного обмена сообщениями все XML подписываются обеими сторонами. Подпись реализована по стандарту W3C описанными в `XSD` схеме [XmlDSig](https://www.w3.org/TR/xmldsig-core/).
Для запроса на проведение платежа используется XSD схема `WebShopRequest.xsd`, для передачи результата о проведенном платеже используется XSD схема WebShopResponse.xsd. Каждое сообщение должно проходить валидацию по соответствующей XSD схеме, все обязательные поля должны быть заполнены по формату.
Используемая кодировка – `UTF-8`

### ОПИСАНИЕ ФОРМАТА СООБЩЕНИЙ

`WebShopRequst`

Пример подписанной XML приведён в файле WebShopRequest.xml. Далее будет приведено описание и назначение каждого поля.

1. `WSReq:ShopName` Название магазина, которое будет видеть Покупатель на странице подтверждения платежей. Обязательное для заполнения
2. `WSReq:InvoiceNumber` Номер заказа, поле должно быть уникальным в базе данных магазина. Обязательное для заполнения
3. `WSReq:Merchant` Составное поле, описывающее аккаунт магазина в ПС Allpay. Обязательное для заполнения 
 * `WSReq:MerchantID` Идентификатор магазина в ПС. Выдается в момент заключения договора. Обязательное для заполнения
 * `WSReq:WalletID` Идентификатор счета в ПС. На этот счет будут переводится деньги от Покупателя. Выдается в момент заключения договора. Обязательное для заполнения
4. `WSReq:Cart` Составное поле, описывающее товары в корзине Покупателя.
 * `WSReq:Items` Составное поле. Описание одной товарной позиции
 * `WSReq:Code` Код товара 
 * `WSReq:Name` Название товара 
 * `WSReq:Description` Описание товара
 * `WSReq:Quantity` Количество товара в соответствующей мере измерения
 * `WSReq:Cost` Стоимость товара
5. `WSReq:TotalCost` Общая сумма к оплате. Обязательное для заполнения
6. `WSReq:RedirectURL` URL Ссылка магазина, на которую попадёт Покупатель после удачного платежа. Обязательное для заполнения
7. `WSReq:FailureLink` URL Ссылка магазина, на которую попадёт Покупатель в случае неудачного платежа. Обязательное для заполнения
8. `Signature` Подпись. Обязательное для заполнения

